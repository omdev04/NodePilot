# NodePilot Main Caddyfile
# This file manages the NodePilot platform and imports all project configurations

# Global options
{
    # Email for Let's Encrypt notifications (CHANGE THIS!)
    email admin@example.com
    
    # Automatic HTTPS
    auto_https on
    
    # Admin API (localhost only for security)
    admin localhost:2019
}

# Import all project configurations from projects directory
# Each deployed project with a domain will have its own .caddy file here
import /etc/caddy/projects/*.caddy

# NodePilot Management Interface
# Development mode - localhost without SSL
:9002 {
    # Frontend (Next.js)
    handle /* {
        reverse_proxy localhost:9000 {
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
        }
    }
    
    # Backend API
    handle /api/* {
        reverse_proxy localhost:9001 {
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
        }
    }
    
    # Health check
    handle /health {
        respond "OK" 200
    }
}

# Production mode - Uncomment and configure with your domain
# Replace nodepilot.yourdomain.com with your actual domain
# nodepilot.yourdomain.com {
#     # Automatic HTTPS with Let's Encrypt
#     
#     # Frontend (Next.js)
#     handle /* {
#         reverse_proxy localhost:9000 {
#             header_up X-Real-IP {remote_host}
#             header_up X-Forwarded-For {remote_host}
#             header_up X-Forwarded-Proto {scheme}
#         }
#     }
#     
#     # Backend API
#     handle /api/* {
#         reverse_proxy localhost:9001 {
#             header_up X-Real-IP {remote_host}
#             header_up X-Forwarded-For {remote_host}
#             header_up X-Forwarded-Proto {scheme}
#         }
#     }
#     
#     # Security headers
#     header {
#         X-Content-Type-Options "nosniff"
#         X-Frame-Options "DENY"
#         X-XSS-Protection "1; mode=block"
#         Referrer-Policy "strict-origin-when-cross-origin"
#         -Server
#     }
#     
#     # Logging
#     log {
#         output file /var/log/caddy/nodepilot.log {
#             roll_size 100mb
#             roll_keep 10
#         }
#     }
# }
